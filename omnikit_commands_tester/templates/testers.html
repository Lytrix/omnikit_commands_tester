{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
    
	<form action="#" method="post" enctype="multipart/form-data">
		<h3>Upload Issue reports, Xcode Logs (.md) or rtlomni captures (.omni)</h3>
		{% csrf_token %}
		{{ form.as_p|crispy }}
    	<input type="file" class="btn btn-info" placeholder=".omni, .md" name="myfile" value="Browse"/>
    	<button type="submit" class="btn btn-success"/>Process</button>
	</form>
  </br>
  {% for report in contentOfFile %}
	{% if report.allcommands %}
    		<hr class="mt-0 mb-2">
    		<h5>All {{report.command_type}} insulin commands in: {{file.name}}</h5>
        	</br>
        	<code>
        	{{ report.matching_tempbasals.header }}
            </br>
        	{% for command in report.allcommands %}
        	  {{ command }}
        	  </br>
    		{% endfor %}
    		</code>
	{% endif %}
	{% if report.matching_tempbasals%}
		<hr class="mt-0 mb-2">
		<h5>Tested matching PDM commands</h5>
    	</br>
    	{{ report.matching_tempbasals.total_results }}
    	<hr class="mt-0 mb-2">
    	<code>
    	{% for test in report.matching_tempbasals.results %}
    	  
    	  {{ test.pdm }}
    	  </br>
    	  {{ test.loop }}
    	  </br>
    	  match: {{ test.match }}
    	  </br>
		{% endfor %}
		</code>
    {% endif %}
    {% if report.flashlogs%}
        <hr class="mt-0 mb-2">
        <h5>Flash logs (Type 51+50)</h5>
        </br>
        <hr class="mt-0 mb-2">
        
        <code>
        {% for logtype in report.flashlogs.results %}
            </br>
            Type {{ logtype.type }}
            <hr class="mt-0 mb-2">
            </br>
            {{ report.flashlogs.header }}
            </br>
            {% for logs in logtype.logs %}
                {{ logs.log }}
                </br>
            {% endfor %}
            {{ report.flashlogs.header }}
            </br>
        {% endfor %}
        </code>
    {% endif %}
  {% endfor %}
  
{% endblock %}